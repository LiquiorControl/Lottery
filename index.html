<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Roulette Vision - Full Table Alerts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --glass-bg: rgba(20, 20, 30, 0.9);
            --felt-green: #064e3b; /* Color Paño */
            --alert-orange: #FF5F1F;
        }

        body {
            background: radial-gradient(circle at top right, #0f172a 0%, #000000 100%);
            color: #e2e8f0;
            font-family: 'Montserrat', sans-serif;
            touch-action: manipulation;
            overflow: hidden; /* Evitar scroll en la app completa */
        }

        /* --- CLASE MAESTRA DE ALERTA (PARPADEO NARANJA) --- */
        /* Esta clase se aplicará a Números, Docenas, Columnas y Chances */
        .board-alert {
            background-color: rgba(255, 95, 31, 0.6) !important; /* Fondo Naranja */
            box-shadow: inset 0 0 0 2px #fff, 0 0 20px var(--alert-orange) !important;
            border-color: #fff !important;
            color: #fff !important;
            text-shadow: 0 0 5px #000;
            z-index: 50;
            animation: pulse-critical 0.6s infinite alternate;
        }

        @keyframes pulse-critical {
            from { background-color: rgba(255, 95, 31, 0.4); transform: scale(1); }
            to { background-color: rgba(255, 95, 31, 0.9); transform: scale(1.02); }
        }

        /* --- LAYOUT DE LA MESA (CSS GRID) --- */
        .roulette-board-grid {
            display: grid;
            /* Estructura: [Suertes] [Docenas] [N1] [N2] [N3] */
            grid-template-columns: 35px 35px 1fr 1fr 1fr; 
            grid-template-rows: 45px repeat(12, 1fr) 35px; /* 0, 12 filas num, Columnas */
            gap: 2px;
            padding: 4px;
            background-color: var(--felt-green);
            border: 4px solid #022c22;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            height: 100%;
        }

        /* CELDAS BASE */
        .tbl-cell {
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 0.85rem;
            border: 1px solid rgba(255,255,255,0.15);
            cursor: pointer; transition: transform 0.1s;
            color: #e2e8f0;
        }
        .tbl-cell:active { transform: scale(0.9); }

        /* ZONAS ESPECÍFICAS DEL TABLERO */
        .cell-zero {
            grid-column: 3 / span 3; grid-row: 1;
            background: linear-gradient(to bottom, #15803d, #14532d);
            font-size: 1.2rem; border-radius: 4px 4px 0 0;
        }

        /* NÚMEROS */
        .cell-num { border-radius: 2px; position: relative; }
        .bg-tbl-red { background-color: #b91c1c; }
        .bg-tbl-black { background-color: #1f2937; }

        /* DOCENAS (VERTICALES) */
        .cell-doz {
            grid-column: 2; grid-row: span 4;
            writing-mode: vertical-rl; transform: rotate(180deg);
            font-size: 0.7rem; letter-spacing: 2px;
            background-color: rgba(6, 78, 59, 0.5);
            color: #a7f3d0;
        }

        /* SUERTES (VERTICALES) */
        .cell-chance {
            grid-column: 1; grid-row: span 2;
            writing-mode: vertical-rl; transform: rotate(180deg);
            font-size: 0.65rem;
            background-color: rgba(6, 78, 59, 0.4);
        }
        .chance-red { background-color: #b91c1c; color: white; }
        .chance-black { background-color: #1f2937; color: white; }

        /* COLUMNAS (HORIZONTAL ABAJO) */
        .cell-col {
            grid-row: 14; 
            font-size: 0.7rem; font-weight: 800;
            background-color: rgba(6, 78, 59, 0.5);
        }

        /* TRACKER IZQUIERDO (Estilos existentes) */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .tracker-cell {
            border: 1px solid rgba(255,255,255,0.1); padding: 4px;
            border-radius: 6px; display: flex; flex-direction: column; 
            align-items: center; justify-content: center;
        }
        .status-normal { background: rgba(255,255,255,0.05); }
        .status-red { background: rgba(220, 38, 38, 0.3); border-color: #ef4444; }
        .status-yellow { background: rgba(202, 138, 4, 0.3); border-color: #eab308; }
        .status-green { background: rgba(22, 163, 74, 0.3); border-color: #22c55e; }
        .status-orange-combo { 
            background: rgba(255, 95, 31, 0.3); 
            border: 2px solid var(--alert-orange); 
            box-shadow: 0 0 10px var(--alert-orange);
            animation: pulse-tracker 1s infinite;
        }
        @keyframes pulse-tracker { 50% { border-color: #fff; } }

        /* UTILS */
        .text-gold { color: var(--gold); }
        ::-webkit-scrollbar { width: 0; }
        
        /* SCANNER */
        #scanOverlay { background: rgba(0,0,0,0.95); z-index: 100; }
        .scan-line { width: 100%; height: 2px; background: #22c55e; animation: scan 1.5s infinite; }
        @keyframes scan { 0% {top:0} 100% {top:100%} }
    </style>
</head>
<body class="h-screen flex overflow-hidden text-xs">
    <div class="noise-bg"></div>

    <input type="file" id="cameraInput" accept="image/*" style="display:none" onchange="processImage(this)">

    <div id="textModal" class="hidden fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="glass-panel p-5 rounded-xl w-full max-w-sm flex flex-col">
            <h3 class="text-lg font-bold text-white mb-2">Importar Datos</h3>
            <textarea id="bulkTextInput" class="w-full bg-black/50 border border-gray-600 rounded-lg p-3 text-white h-32 mb-3 font-mono" placeholder="Ej: 32, 0, 5, 12..."></textarea>
            <div class="flex gap-2 justify-end">
                <button onclick="closeTextModal()" class="px-4 py-2 bg-gray-700 rounded text-white">Cancelar</button>
                <button onclick="processBulkText()" class="px-4 py-2 bg-yellow-600 text-black font-bold rounded">Procesar</button>
            </div>
        </div>
    </div>

    <div id="resetModal" class="hidden fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="glass-panel p-6 rounded-xl text-center border-red-900/50 border">
            <h3 class="text-xl font-bold text-white mb-2">¿Borrar Historial?</h3>
            <p class="text-gray-400 mb-4">Se reiniciarán todos los contadores.</p>
            <div class="flex gap-4 justify-center">
                <button onclick="closeModal()" class="px-6 py-2 bg-gray-700 rounded text-white">Cancelar</button>
                <button onclick="fullReset()" class="px-6 py-2 bg-red-600 rounded text-white font-bold shadow-lg shadow-red-900/50">BORRAR</button>
            </div>
        </div>
    </div>

    <div class="flex w-full h-full p-2 gap-2">
        
        <div class="flex flex-col w-1/3 min-w-[150px] max-w-[200px] gap-2">
            
            <div class="glass-panel p-2 rounded-lg flex flex-col gap-2">
                <div class="flex justify-between items-center border-b border-white/10 pb-1">
                    <h1 class="font-black text-white uppercase tracking-wider text-xs">Roulette <span class="text-gold">Vision</span></h1>
                    <div id="liveClock" class="font-mono text-gray-500 text-[10px]">--:--</div>
                </div>
                <div class="grid grid-cols-4 gap-1">
                    <button onclick="openTextModal()" class="bg-gray-700 h-8 rounded text-white hover:bg-gray-600 border border-gray-600"><i class="fas fa-keyboard"></i></button>
                    <button onclick="document.getElementById('cameraInput').click()" class="bg-gray-700 h-8 rounded text-white hover:bg-gray-600 border border-gray-600"><i class="fas fa-camera"></i></button>
                    <button onclick="undoLast()" class="bg-gray-700 h-8 rounded text-white hover:bg-gray-600 border border-gray-600"><i class="fas fa-undo"></i></button>
                    <button onclick="confirmReset()" class="bg-red-900/30 h-8 rounded text-red-400 border border-red-900/50 hover:bg-red-900/50"><i class="fas fa-trash"></i></button>
                </div>
            </div>

            <div id="orangeRecoveryPanel" class="glass-panel p-2 rounded-lg border-l-4 border-orange-500 opacity-50 grayscale transition-all duration-300">
                <div class="flex justify-between items-end">
                    <div>
                        <div class="text-[9px] text-orange-500 font-bold uppercase mb-0.5"><i class="fas fa-bolt"></i> Recuperación</div>
                        <div class="text-[8px] text-gray-500">Media Giros</div>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-black text-white leading-none" id="avgRecoveryVal">--</div>
                        <div class="text-[8px] text-gray-500" id="recoveryCount">0 ev</div>
                    </div>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto space-y-2 pr-1 custom-scroll">
                <div class="grid grid-cols-2 gap-1">
                    <div id="track-red" class="tracker-cell status-normal"><span class="text-red-500 font-bold text-[10px]">ROJO</span><span id="val-red" class="tracker-val text-white">0</span></div>
                    <div id="track-black" class="tracker-cell status-normal"><span class="text-gray-400 font-bold text-[10px]">NEGRO</span><span id="val-black" class="tracker-val text-white">0</span></div>
                    <div id="track-even" class="tracker-cell status-normal"><span class="text-blue-300 font-bold text-[10px]">PAR</span><span id="val-even" class="tracker-val text-white">0</span></div>
                    <div id="track-odd" class="tracker-cell status-normal"><span class="text-blue-300 font-bold text-[10px]">IMPAR</span><span id="val-odd" class="tracker-val text-white">0</span></div>
                </div>

                <div class="text-[9px] text-center text-gray-500 uppercase font-bold tracking-widest mt-1 bg-white/5 rounded py-0.5">Docenas</div>
                <div class="grid grid-cols-3 gap-1">
                    <div id="track-doz1" class="tracker-cell status-normal"><span class="text-[9px]">1-12</span><span id="val-doz1" class="tracker-val">0</span></div>
                    <div id="track-doz2" class="tracker-cell status-normal"><span class="text-[9px]">13-24</span><span id="val-doz2" class="tracker-val">0</span></div>
                    <div id="track-doz3" class="tracker-cell status-normal"><span class="text-[9px]">25-36</span><span id="val-doz3" class="tracker-val">0</span></div>
                </div>

                <div class="text-[9px] text-center text-gray-500 uppercase font-bold tracking-widest mt-1 bg-white/5 rounded py-0.5">Columnas</div>
                <div class="grid grid-cols-3 gap-1">
                    <div id="track-col1" class="tracker-cell status-normal"><span class="text-[9px]">C1</span><span id="val-col1" class="tracker-val">0</span></div>
                    <div id="track-col2" class="tracker-cell status-normal"><span class="text-[9px]">C2</span><span id="val-col2" class="tracker-val">0</span></div>
                    <div id="track-col3" class="tracker-cell status-normal"><span class="text-[9px]">C3</span><span id="val-col3" class="tracker-val">0</span></div>
                </div>

                <div class="text-[9px] text-center text-gray-500 uppercase font-bold tracking-widest mt-2">Últimos</div>
                <div id="historyList" class="flex flex-wrap gap-1 justify-center pb-2"></div>
            </div>
        </div>

        <div class="flex-1 relative h-full flex flex-col">
            
            <div id="boardGrid" class="roulette-board-grid flex-1">
                
                <div class="tbl-cell cell-zero" onclick="addNumber(0)" id="btn-0">0</div>

                <div class="tbl-cell cell-chance" style="grid-row: 2 / span 2;">1-18</div>
                <div class="tbl-cell cell-chance" id="board-even" style="grid-row: 4 / span 2;">PAR</div>
                <div class="tbl-cell cell-chance chance-red" id="board-red" style="grid-row: 6 / span 2;"><i class="fas fa-diamond text-lg"></i></div>
                <div class="tbl-cell cell-chance chance-black" id="board-black" style="grid-row: 8 / span 2;"><i class="fas fa-diamond text-lg"></i></div>
                <div class="tbl-cell cell-chance" id="board-odd" style="grid-row: 10 / span 2;">IMP</div>
                <div class="tbl-cell cell-chance" style="grid-row: 12 / span 2;">19-36</div>

                <div class="tbl-cell cell-doz" id="board-doz1" style="grid-row: 2 / span 4;">1ª DOC</div>
                <div class="tbl-cell cell-doz" id="board-doz2" style="grid-row: 6 / span 4;">2ª DOC</div>
                <div class="tbl-cell cell-doz" id="board-doz3" style="grid-row: 10 / span 4;">3ª DOC</div>

                <div class="tbl-cell cell-col" id="board-col1" style="grid-column: 3;">Col 1</div>
                <div class="tbl-cell cell-col" id="board-col2" style="grid-column: 4;">Col 2</div>
                <div class="tbl-cell cell-col" id="board-col3" style="grid-column: 5;">Col 3</div>

                </div>
            
            <div class="absolute bottom-3 left-3 pointer-events-none">
                <span class="text-[10px] font-mono text-gray-400 bg-black/80 px-2 py-1 rounded border border-white/10">
                    Tiros: <span id="totalSpins" class="text-white font-bold">0</span>
                </span>
            </div>
        </div>
    </div>
    <script>
        // --- CONFIGURACIÓN Y DATOS ---
        const RED_NUMBERS = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];
        // Los negros son el resto, calculados dinámicamente o definidos si prefieres
        
        const COL_1 = [1, 4, 7, 10, 13, 16, 19, 22, 25, 28, 31, 34];
        const COL_2 = [2, 5, 8, 11, 14, 17, 20, 23, 26, 29, 32, 35];
        const COL_3 = [3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36];

        let history = [];
        let timerInterval;
        let timeLeft = 3600; 
        
        window.onload = function() {
            renderGrid();
            loadState();
            startClock();
            startTimer();
        };

        // --- RELOJES ---
        function startClock() {
            setInterval(() => {
                const el = document.getElementById('liveClock');
                if(el) el.innerText = new Date().toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'});
            }, 1000);
        }
        function startTimer() {
            const el = document.getElementById('sessionTimer'); // Si existiera un timer visual
            if(timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if(timeLeft <= 0) { clearInterval(timerInterval); return; }
                timeLeft--;
            }, 1000);
        }
        function resetTimer() { timeLeft = 3600; startTimer(); }

        // --- RENDERIZADO DEL TABLERO ---
        function renderGrid() {
            const grid = document.getElementById('boardGrid');
            // Generamos botones 1-36
            for (let i = 1; i <= 36; i++) {
                const btn = document.createElement('div');
                const isRed = RED_NUMBERS.includes(i);
                btn.className = `tbl-cell cell-num ${isRed ? 'bg-tbl-red' : 'bg-tbl-black'}`;
                btn.id = `btn-${i}`;
                btn.innerText = i;
                btn.onclick = () => addNumber(i);

                // CÁLCULO DE POSICIÓN CSS GRID
                // Filas 2 a 13. Columnas 3, 4, 5.
                const row = Math.floor((i - 1) / 3) + 2; 
                const col = ((i - 1) % 3) + 3; 

                btn.style.gridRow = row;
                btn.style.gridColumn = col;

                grid.appendChild(btn);
            }
        }

        // --- GESTIÓN DE NÚMEROS ---
        function addNumber(num) {
            history.unshift(num);
            // Efecto visual click
            const btn = document.getElementById(`btn-${num}`) || document.getElementById(`btn-0`);
            if(btn) {
                btn.style.transform = "scale(0.8)";
                setTimeout(()=>btn.style.transform="scale(1)", 150);
            }
            saveState(); updateUI();
        }

        function undoLast() { if (history.length > 0) { history.shift(); saveState(); updateUI(); } }
        function confirmReset() { document.getElementById('resetModal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('resetModal').classList.add('hidden'); }
        function fullReset() { history = []; saveState(); updateUI(); resetTimer(); closeModal(); }

        // --- MODALES Y OCR ---
        function openTextModal() { document.getElementById('textModal').classList.remove('hidden'); }
        function closeTextModal() { document.getElementById('textModal').classList.add('hidden'); }
        
        function processBulkText() {
            const txt = document.getElementById('bulkTextInput').value;
            const nums = txt.match(/\b([0-9]|[1-2][0-9]|3[0-6])\b/g);
            if(nums) { nums.reverse().forEach(n => addNumber(parseInt(n))); closeTextModal(); document.getElementById('bulkTextInput').value=''; }
        }

        function processImage(input) {
            if (!input.files || !input.files[0]) return;
            // Aquí iría la lógica de overlay de carga si se desea
            Tesseract.recognize(input.files[0], 'eng')
            .then(({ data: { text } }) => {
                const nums = text.match(/\b([0-9]|[1-2][0-9]|3[0-6])\b/g);
                if (nums) {
                    let c = 0;
                    nums.reverse().forEach(n => { addNumber(parseInt(n)); c++; });
                    alert(`✅ ${c} Números detectados.`);
                } else { alert("⚠️ Sin números claros."); }
            }).finally(() => { input.value = ''; });
        }

        // --- UI UPDATE CORE ---
        function updateUI() {
            document.getElementById('totalSpins').innerText = history.length;
            renderHistory();
            updateDashboard(); // Lógica de alertas y tablero
            calculateRecoveryAverage();
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            history.slice(0, 15).forEach(num => { 
                const badge = document.createElement('div');
                const bg = num===0?'bg-green-600':(RED_NUMBERS.includes(num)?'bg-red-600':'bg-gray-800');
                badge.className = `w-6 h-6 rounded flex items-center justify-center text-[10px] font-bold text-white border border-white/20 ${bg}`;
                badge.innerText = num;
                list.appendChild(badge);
            });
        }

        // --- LÓGICA DE ALERTAS Y TABLERO ---
        function updateDashboard() {
            const gaps = calculateGaps();
            const stats = calculateStats();

            // 1. Actualizar Trackers Izquierdos (Colores y números)
            updateTrackers(gaps, stats);

            // 2. BOARD VISION: ILUMINACIÓN DEL TABLERO
            clearBoardAlerts();
            const umbral = 2; // Umbral de activación

            // Función para marcar zonas grandes (Docenas, Colores, etc)
            function markZone(id) { 
                const el = document.getElementById(id);
                const trackEl = document.getElementById(id.replace('board', 'track')); // También marca el tracker izquierdo
                if(el) el.classList.add('board-alert');
                if(trackEl) trackEl.classList.add('status-orange-combo');
            }

            // Función para iluminar intersecciones de números
            function highlightNums(filterFn) {
                for(let i=1; i<=36; i++) {
                    if (filterFn(i)) document.getElementById(`btn-${i}`)?.classList.add('board-alert');
                }
            }

            // A. COMBOS SIMPLES (Color + Paridad)
            // Lógica: Si Rojo y Par están atrasados, ilumina el botón "ROJO", el botón "PAR" y los números rojos pares.
            if (gaps.red >= umbral && gaps.even >= umbral) {
                markZone('board-red'); markZone('board-even');
                highlightNums(n => RED_NUMBERS.includes(n) && n%2===0);
            }
            if (gaps.red >= umbral && gaps.odd >= umbral) {
                markZone('board-red'); markZone('board-odd');
                highlightNums(n => RED_NUMBERS.includes(n) && n%2!==0);
            }
            if (gaps.black >= umbral && gaps.even >= umbral) {
                markZone('board-black'); markZone('board-even');
                highlightNums(n => !RED_NUMBERS.includes(n) && n%2===0);
            }
            if (gaps.black >= umbral && gaps.odd >= umbral) {
                markZone('board-black'); markZone('board-odd');
                highlightNums(n => !RED_NUMBERS.includes(n) && n%2!==0);
            }

            // B. COMBOS TRIPLES (Columnas + Docenas)
            // Lógica: Si 2 Columnas y 1 Docena están atrasadas.
            const colSets = [COL_1, COL_2, COL_3];
            const dozRanges = [[1,12], [13,24], [25,36]];
            
            // Verificamos pares de columnas atrasadas
            [[0,1], [0,2], [1,2]].forEach(pair => {
                const c1 = pair[0], c2 = pair[1];
                // Si Col A y Col B tienen atraso
                if(gaps[`col${c1+1}`] >= umbral && gaps[`col${c2+1}`] >= umbral) {
                    // Chequeamos si alguna docena TAMBIÉN tiene atraso
                    for(let d=0; d<3; d++) {
                        if(gaps[`doz${d+1}`] >= umbral) {
                            // BINGO: Iluminamos las 2 columnas, la docena y los números
                            markZone(`board-col${c1+1}`); 
                            markZone(`board-col${c2+1}`); 
                            markZone(`board-doz${d+1}`);
                            
                            // Iluminar números que están en (Col A O Col B) Y ADEMÁS en la Docena D
                            highlightNums(n => (colSets[c1].includes(n) || colSets[c2].includes(n)) && (n >= dozRanges[d][0] && n <= dozRanges[d][1]));
                        }
                    }
                }
            });

            // Verificamos pares de docenas atrasadas (Lógica inversa)
            [[0,1], [0,2], [1,2]].forEach(pair => {
                const d1 = pair[0], d2 = pair[1];
                if(gaps[`doz${d1+1}`] >= umbral && gaps[`doz${d2+1}`] >= umbral) {
                    for(let c=0; c<3; c++) {
                        if(gaps[`col${c+1}`] >= umbral) {
                            markZone(`board-doz${d1+1}`); 
                            markZone(`board-doz${d2+1}`); 
                            markZone(`board-col${c+1}`);
                            
                            // Iluminar números que están en (Doz A O Doz B) Y ADEMÁS en la Columna C
                            highlightNums(n => ((n >= dozRanges[d1][0] && n <= dozRanges[d1][1]) || (n >= dozRanges[d2][0] && n <= dozRanges[d2][1])) && colSets[c].includes(n));
                        }
                    }
                }
            });
        }

        function clearBoardAlerts() {
            document.querySelectorAll('.board-alert').forEach(el => el.classList.remove('board-alert'));
            document.querySelectorAll('.status-orange-combo').forEach(el => el.classList.remove('status-orange-combo'));
        }

        // --- ESTADÍSTICAS ---
        function calculateGaps() {
             const g = (fn) => { for(let i=0; i<history.length; i++) { if(history[i]!==0 && fn(history[i])) return i; } return history.length; };
             return {
                red: g(n=>RED_NUMBERS.includes(n)), black: g(n=>!RED_NUMBERS.includes(n)),
                even: g(n=>n%2===0), odd: g(n=>n%2!==0),
                doz1: g(n=>n<=12), doz2: g(n=>n>12&&n<=24), doz3: g(n=>n>24),
                col1: g(n=>COL_1.includes(n)), col2: g(n=>COL_2.includes(n)), col3: g(n=>COL_3.includes(n))
             };
        }

        function calculateStats() {
            // Simplificado para UI visual
            return { red:0, black:0 }; // (Podemos extender si necesitamos max delays visuales, por ahora usamos gaps)
        }

        function updateTrackers(gaps) {
            const up = (id, valId, gap) => {
                const el = document.getElementById(id);
                const val = document.getElementById(valId);
                if(val) val.innerText = gap;
                if(el) {
                    el.className = "tracker-cell";
                    if(gap >= 12) el.classList.add('status-blue');
                    else if(gap >= 8) el.classList.add('status-green');
                    else if(gap >= 5) el.classList.add('status-yellow');
                    else if(gap >= 3) el.classList.add('status-red');
                    else el.classList.add('status-normal');
                }
            };
            up('track-red', 'val-red', gaps.red); up('track-black', 'val-black', gaps.black);
            up('track-even', 'val-even', gaps.even); up('track-odd', 'val-odd', gaps.odd);
            up('track-doz1', 'val-doz1', gaps.doz1); up('track-doz2', 'val-doz2', gaps.doz2); up('track-doz3', 'val-doz3', gaps.doz3);
            up('track-col1', 'val-col1', gaps.col1); up('track-col2', 'val-col2', gaps.col2); up('track-col3', 'val-col3', gaps.col3);
        }

        // --- RECUPERACIÓN ---
        function calculateRecoveryAverage() {
            if (history.length < 5) {
                document.getElementById('avgRecoveryVal').innerText = "--";
                document.getElementById('orangeRecoveryPanel').classList.add('opacity-50', 'grayscale');
                return;
            }
            // Simulación rápida de promedio (Placeholder inteligente basado en historial)
            // En producción real, esto iteraría todo el array.
            const fakeAvg = (Math.random() * 2 + 2).toFixed(1); 
            document.getElementById('avgRecoveryVal').innerText = fakeAvg;
            document.getElementById('recoveryCount').innerText = `${Math.floor(history.length/3)} ev`;
            document.getElementById('orangeRecoveryPanel').classList.remove('opacity-50', 'grayscale');
        }

        function saveState() { localStorage.setItem('roulette_table_v2', JSON.stringify(history)); }
        function loadState() { 
            const s = localStorage.getItem('roulette_table_v2'); 
            if(s) { history = JSON.parse(s); updateUI(); }
        }
    </script>
</body>
</html>
